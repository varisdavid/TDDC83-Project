function (user, context, callback) {
  // TODO: implement your rule
  var roles_to_assign = context.idToken['https://company3.com/roles_to_assign'];
  
  if(roles_to_assign !== null && Array.isArray(roles_to_assign) && roles_to_assign.length > 0) {
    var ManagementClient = require('auth0@2.17.0').ManagementClient;
    var management = new ManagementClient({
      token: auth0.accessToken,
      domain: auth0.domain
    });

    management.assignRolestoUser(
      { id : user.user_id}, 
      { "roles" :roles_to_assign},  // sample role ID of "Standard API Enduser"
      function (err) {
        if (err) {
          console.log('Error assigning role: ' + err);
        }
        delete context.idToken['https://company3.com/roles_to_assign'];
        callback(null, user, context);
    });
  } else {
    delete context.idToken['https://company3.com/roles_to_assign'];
    callback(null, user, context);
  }
}